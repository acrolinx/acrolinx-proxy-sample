name: Test Java Proxy 

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  schedule:
    - cron: "* 12 * * *"
  workflow_dispatch:
    inputs:
      reason:
        description: "Trigger Comment (Optional)"
        required: false
        default: "Manual Workflow Run"

jobs:
  build:
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash

    steps:
    - uses: actions/checkout@v2
    - name: Set up JDK 8
      uses: actions/setup-java@v2
      with:
        java-version: '8'
        distribution: 'adopt'

    - name: Build proxy
      run: |
        cd java/servlet/
        mvn compile

    - name: Test proxy with Stable
      env:
        ACROLINX_API_USERNAME: ${{ secrets.TEST_SERVER_USERNAME }}
        ACROLINX_API_SSO_TOKEN: ${{ secrets.TEST_SERVER_SSO_TOKEN }}
        ACROLINX_URL: ${{ secrets.TEST_SERVER_URL_STABLE }}
        ACROLINX_API_TOKEN: ${{ secrets.TEST_SERVER_API_TOKEN_STABLE }}
        ACROLINX_DEV_SIGNATURE: ${{ secrets.ACROLINX_DEV_SIGNATURE }}

      run: |
        cd java/servlet/
        mvn '-Dtest=com.acrolinx.*Test' test
